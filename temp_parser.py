# –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è HTTP-–∑–∞–ø–∏—Ç—ñ–≤ (GET, POST —Ç–æ—â–æ)
# –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è HTML-—Å—Ç–æ—Ä—ñ–Ω–æ–∫
import requests

# BeautifulSoup - –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥—É HTML —Ç–∞ XML
# –î–æ–∑–≤–æ–ª—è—î –∑—Ä—É—á–Ω–æ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ —Ç–µ–≥–∞–º–∏, –∫–ª–∞—Å–∞–º–∏, –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏
from bs4 import BeautifulSoup

# urllib - –≤–±—É–¥–æ–≤–∞–Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ Python –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ URL-–∞–¥—Ä–µ—Å–∞–º–∏
# –§—É–Ω–∫—Ü—ñ—è urljoin –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ–±'—î–¥–Ω–∞–Ω–Ω—è –±–∞–∑–æ–≤–æ–≥–æ URL –∑ –≤—ñ–¥–Ω–æ—Å–Ω–∏–º–∏ —à–ª—è—Ö–∞–º–∏
# –ó–∞—Ö–∏—â–∞—î –≤—ñ–¥ –ø–æ–º–∏–ª–æ–∫ –∑—ñ —Å–ª–µ—à–∞–º–∏ ("/") –ø—Ä–∏ —Å–∫–ª–∞–¥–∞–Ω–Ω—ñ –∞–¥—Ä–µ—Å
from urllib.parse import urljoin

# fake_useragent - —Å—Ç–æ—Ä–æ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö User-Agent
# –Ü–º—ñ—Ç—É—î –∑–∞–ø–∏—Ç–∏ –≤—ñ–¥ —Ä—ñ–∑–Ω–∏—Ö –±—Ä–∞—É–∑–µ—Ä—ñ–≤ (Chrome, Firefox, Safari —Ç–æ—â–æ)
# –î–æ–ø–æ–º–∞–≥–∞—î –∑—Ä–æ–±–∏—Ç–∏ HTTP-–∑–∞–ø–∏—Ç —Å—Ö–æ–∂–∏–º –Ω–∞ –∑–∞–ø–∏—Ç –≤—ñ–¥ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
from fake_useragent import UserAgent

# urllib3 - —Å—Ç–æ—Ä–æ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ HTTP-–∑–∞–ø–∏—Ç–∞–º–∏
# Retry - –º–µ—Ö–∞–Ω—ñ–∑–º –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö HTTP-–∑–∞–ø–∏—Ç—ñ–≤ —É —Ä–∞–∑—ñ –ø–æ–º–∏–ª–æ–∫ –∞–±–æ –∑–±–æ—ó–≤ –∑'—î–¥–Ω–∞–Ω–Ω—è
# –î–æ–∑–≤–æ–ª—è—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–≤—Ç–æ—Ä—é–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏ –ø—Ä–∏ —Ç–∏–º—á–∞—Å–æ–≤–∏—Ö –ø–æ–º–∏–ª–∫–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞
# (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 500, 502, 503, 504)
from urllib3.util.retry import Retry

# HTTPAdapter - –¥–æ–∑–≤–æ–ª—è—î –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º Retry –¥–æ requests.Session
# –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤, —Ç–∞–π–º–∞—É—Ç—ñ–≤ —ñ –∞–¥–∞–ø—Ç–µ—Ä—ñ–≤ –∑'—î–¥–Ω–∞–Ω–Ω—è
from requests.adapters import HTTPAdapter

# –°—Ç–≤–æ—Ä—é—î–º–æ –æ–±'—î–∫—Ç –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö User-Agent
# –ö–æ–∂–µ–Ω –≤–∏–∫–ª–∏–∫ user_agent.random –ø–æ–≤–µ—Ä—Ç–∞—î —ñ–Ω—à–∏–π User-Agent –±—Ä–∞—É–∑–µ—Ä–∞
user_agent = UserAgent()

# –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö HTTP-–∑–∞–ø–∏—Ç—ñ–≤
retry_strategy = Retry(
    total=3,  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–± (1 –æ—Å–Ω–æ–≤–Ω–∞ + 2 –ø–æ–≤—Ç–æ—Ä–∏)
    backoff_factor=1,  # –ë–∞–∑–æ–≤–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –º—ñ–∂ —Å–ø—Ä–æ–±–∞–º–∏ (—Å–µ–∫—É–Ω–¥–∏), –∑—Ä–æ—Å—Ç–∞—î –µ–∫—Å–ø–æ–Ω–µ–Ω—Ü—ñ–π–Ω–æ (1s...2s...4s)
    status_forcelist=[  # –ö–æ–¥–∏ –ø–æ–º–∏–ª–æ–∫, –ø—Ä–∏ —è–∫–∏—Ö —Ç—Ä–µ–±–∞ –ø–æ–≤—Ç–æ—Ä—é–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç
        429,  # Too Many Requests (–∑–∞–Ω–∞–¥—Ç–æ –±–∞–≥–∞—Ç–æ –∑–∞–ø–∏—Ç—ñ–≤, —Å–µ—Ä–≤–µ—Ä —Ç–∏–º—á–∞—Å–æ–≤–æ –±–ª–æ–∫—É—î)
        500,  # Internal Server Error (–≤–Ω—É—Ç—Ä—ñ—à–Ω—è –ø–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞)
        502,  # Bad Gateway (—Å–µ—Ä–≤–µ—Ä –æ—Ç—Ä–∏–º–∞–≤ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ —ñ–Ω—à–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)
        503,  # Service Unavailable (—Å–µ—Ä–≤–µ—Ä —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π)
        504  # Gateway Timeout (—Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç—Ä–∏–º–∞–≤ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ —ñ–Ω—à–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)
    ],
    # Retry –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –¥–æ GET-–∑–∞–ø–∏—Ç—ñ–≤
    allowed_methods=["GET"]
)

# –°—Ç–≤–æ—Ä—é—î–º–æ HTTP-—Å–µ—Å—ñ—é
# Session –¥–æ–∑–≤–æ–ª—è—î:
# - –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ TCP-–∑'—î–¥–Ω–∞–Ω–Ω—è
# - –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏ —à–≤–∏–¥—à–µ, –Ω—ñ–∂ requests.get()
# - –∑–∞–¥–∞–≤–∞—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (headers, retry —Ç–æ—â–æ)
session = requests.Session()

# –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ retry-—Å—Ç—Ä–∞—Ç–µ–≥—ñ—é –¥–ª—è HTTPS-–∑–∞–ø–∏—Ç—ñ–≤
session.mount("https://", HTTPAdapter(max_retries=retry_strategy))

# –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ retry-—Å—Ç—Ä–∞—Ç–µ–≥—ñ—é –¥–ª—è HTTP-–∑–∞–ø–∏—Ç—ñ–≤
session.mount("http://", HTTPAdapter(max_retries=retry_strategy))

# –ë–∞–∑–æ–≤–∏–π –¥–æ–º–µ–Ω —Å–∞–π—Ç—É
BASE_URL = "https://webscraper.io/"

# –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –º–∞–≥–∞–∑–∏–Ω—É
# urljoin –ø–æ—î–¥–Ω—É—î –±–∞–∑–æ–≤–∏–π URL —Ç–∞ –≤—ñ–¥–Ω–æ—Å–Ω–∏–π —à–ª—è—Ö,
# –≥–∞—Ä–∞–Ω—Ç—É—é—á–∏ –∫–æ—Ä–µ–∫—Ç–Ω—É –∞–¥—Ä–µ—Å—É –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Å–ª–µ—à—ñ–≤
HOME_URL = urljoin(BASE_URL, "test-sites/e-commerce/allinone/")

# HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–∏ —ñ–º—ñ—Ç—É—é—Ç—å –ø–æ–≤–µ–¥—ñ–Ω–∫—É —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞
HEADERS = {
    # –í–∏–ø–∞–¥–∫–æ–≤–∏–π User-Agent (Chrome, Firefox, Safari —Ç–æ—â–æ)
    'User-Agent': user_agent.random,
    # –¢–∏–ø–∏ –∫–æ–Ω—Ç–µ–Ω—Ç—É, —è–∫—ñ –æ—á—ñ–∫—É—î–º–æ –≤—ñ–¥ —Å–µ—Ä–≤–µ—Ä–∞
    'Accept': (
        'text/html,application/xhtml+xml,application/xml;'
        'q=0.9,image/webp,*/*;q=0.8'
    ),
    # –ú–æ–≤–∞ –∫–æ–Ω—Ç–µ–Ω—Ç—É (—Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ —Ä—ñ–∑–Ω–∏–π HTML)
    'Accept-Language': 'en-US,en;q=0.5',
    # –ó'—î–¥–Ω–∞–Ω–Ω—è –Ω–µ –∑–∞–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –æ–¥—Ä–∞–∑—É, –ø–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è TCP-–∑'—î–¥–Ω–∞–Ω–Ω—è
    'Connection': 'keep-alive',
    # –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç HTTPS, —è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤–µ—Ä—Å—ñ—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    'Upgrade-Insecure-Requests': '1',
}

def get_home_products():
    """
    –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î HTML-–∫–æ–¥ –≥–æ–ª–æ–≤–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –º–∞–≥–∞–∑–∏–Ω—É
    —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î –æ–±'—î–∫—Ç BeautifulSoup –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥—É

    Returns:
        BeautifulSoup | None
    """
    try:
        # –í–∏–∫–æ–Ω—É—î–º–æ HTTP GET-–∑–∞–ø–∏—Ç –¥–æ –≥–æ–ª–æ–≤–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        response = session.get(
            HOME_URL,  # URL —Å—Ç–æ—Ä—ñ–Ω–∫–∏
            headers=HEADERS,  # HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–∏
            timeout=10,  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —á–∞—Å –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (—Å–µ–∫—É–Ω–¥–∏)
            verify=True  # –ü–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ SSL-—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç
        )

        # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç—É—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
        # –Ø–∫—â–æ –∫–æ–¥ 4xx –∞–±–æ 5xx - –±—É–¥–µ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ –≤–∏–Ω—è—Ç–æ–∫
        response.raise_for_status()

        # –û–Ω–æ–≤–ª—é—î–º–æ User-Agent –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É,
        # —â–æ–± –∫–æ–∂–µ–Ω –∑–∞–ø–∏—Ç –≤–∏–≥–ª—è–¥–∞–≤ —è–∫ –Ω–æ–≤–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
        headers = HEADERS.copy()
        headers["User-Agent"] = user_agent.random

        # –°—Ç–≤–æ—Ä–∏–º–æ –æ–±'—î–∫—Ç BeautifulSoup
        # response.content - –±–∞–π—Ç–∏ HTML, –Ω–µ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –∫–æ–¥—É–≤–∞–Ω–Ω—è
        # (–±—ñ–ª—å—à –Ω–∞–¥—ñ–π–Ω–æ, –Ω—ñ–∂ response.text, —è–∫–∏–π –¥–µ–∫–æ–¥—É—î –≤ str)
        soup = BeautifulSoup(response.content, 'html.parser')

        # –í–∏–≤–æ–¥–∏–º–æ HTML-–∫–æ–¥ –∑ –≤—ñ–¥—Å—Ç—É–ø–∞–º–∏
        # ‚ö†Ô∏è –î–ª—è –≤–µ–ª–∏–∫–∏—Ö —Å—Ç–æ—Ä—ñ–Ω–æ–∫ –∫—Ä–∞—â–µ –∑–∞–∫–æ–º–µ–Ω—Ç—É–≤–∞—Ç–∏
        print(soup.prettify())

        # –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –æ–±'—î–∫—Ç BeautifulSoup
        return soup

    # –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫, –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑ HTTP –∞–±–æ –º–µ—Ä–µ–∂–µ—é
    except requests.exceptions.RequestException as e:
        print(f"‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ –∑–∞–ø–∏—Ç—É: {e}")
        return None
    # –û–±—Ä–æ–±–∫–∞ –±—É–¥—å-—è–∫–∏—Ö —ñ–Ω—à–∏—Ö –Ω–µ–æ—á—ñ–∫—É–≤–∞–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫
    except Exception as e:
        print(f"‚ö†Ô∏è –ù–µ–æ—á—ñ–∫—É–≤–∞–Ω–∞ –ø–æ–º–∏–ª–∫–∞: {e}")
        return None

def main():
    """
    –ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –ø—Ä–æ–≥—Ä–∞–º–∏
    –í–∏–∫–ª–∏–∫–∞—î –æ—Å–Ω–æ–≤–Ω—É –ª–æ–≥—ñ–∫—É —Ç–∞ –∑–∞–∫—Ä–∏–≤–∞—î —Ä–µ—Å—É—Ä—Å–∏
    """
    try:
        # –û—Ç—Ä–∏–º—É—î–º–æ HTML-–¥–∞–Ω—ñ –≥–æ–ª–æ–≤–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        soup = get_home_products()
        return soup

    # –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–Ω—É–≤ Ctrl + C
    except KeyboardInterrupt:
        print("\nüõë –†–æ–±–æ—Ç—É –ø—Ä–æ–≥—Ä–∞–º–∏ –ø–µ—Ä–µ—Ä–≤–∞–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º")
    # –õ–æ–≤–∏–º–æ –±—É–¥—å-—è–∫—É –∫—Ä–∏—Ç–∏—á–Ω—É –ø–æ–º–∏–ª–∫—É
    except Exception as e:
        print(f"‚ùå –ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞: {e}")
    # –ë–ª–æ–∫ finally –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ó–ê–í–ñ–î–ò
    finally:
        # –ó–∞–∫—Ä–∏–≤–∞—î–º–æ HTTP-—Å–µ—Å—ñ—é
        session.close()

if __name__ == "__main__":
    main()