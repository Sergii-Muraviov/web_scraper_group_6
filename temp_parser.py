# –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è HTTP-–∑–∞–ø–∏—Ç—ñ–≤ (GET, POST —Ç–æ—â–æ)
# –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è HTML-—Å—Ç–æ—Ä—ñ–Ω–æ–∫
import requests

# BeautifulSoup - –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥—É HTML —Ç–∞ XML
# –î–æ–∑–≤–æ–ª—è—î –∑—Ä—É—á–Ω–æ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ —Ç–µ–≥–∞–º–∏, –∫–ª–∞—Å–∞–º–∏, –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏
from bs4 import BeautifulSoup, Tag

# urllib - –≤–±—É–¥–æ–≤–∞–Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ Python –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ URL-–∞–¥—Ä–µ—Å–∞–º–∏
# –§—É–Ω–∫—Ü—ñ—è urljoin –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ–±'—î–¥–Ω–∞–Ω–Ω—è –±–∞–∑–æ–≤–æ–≥–æ URL –∑ –≤—ñ–¥–Ω–æ—Å–Ω–∏–º–∏ —à–ª—è—Ö–∞–º–∏
# –ó–∞—Ö–∏—â–∞—î –≤—ñ–¥ –ø–æ–º–∏–ª–æ–∫ –∑—ñ —Å–ª–µ—à–∞–º–∏ ("/") –ø—Ä–∏ —Å–∫–ª–∞–¥–∞–Ω–Ω—ñ –∞–¥—Ä–µ—Å
from urllib.parse import urljoin

# fake_useragent - —Å—Ç–æ—Ä–æ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö User-Agent
# –Ü–º—ñ—Ç—É—î –∑–∞–ø–∏—Ç–∏ –≤—ñ–¥ —Ä—ñ–∑–Ω–∏—Ö –±—Ä–∞—É–∑–µ—Ä—ñ–≤ (Chrome, Firefox, Safari —Ç–æ—â–æ)
# –î–æ–ø–æ–º–∞–≥–∞—î –∑—Ä–æ–±–∏—Ç–∏ HTTP-–∑–∞–ø–∏—Ç —Å—Ö–æ–∂–∏–º –Ω–∞ –∑–∞–ø–∏—Ç –≤—ñ–¥ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
from fake_useragent import UserAgent

# urllib3 - —Å—Ç–æ—Ä–æ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ HTTP-–∑–∞–ø–∏—Ç–∞–º–∏
# Retry - –º–µ—Ö–∞–Ω—ñ–∑–º –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö HTTP-–∑–∞–ø–∏—Ç—ñ–≤ —É —Ä–∞–∑—ñ –ø–æ–º–∏–ª–æ–∫ –∞–±–æ –∑–±–æ—ó–≤ –∑'—î–¥–Ω–∞–Ω–Ω—è
# –î–æ–∑–≤–æ–ª—è—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–≤—Ç–æ—Ä—é–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏ –ø—Ä–∏ —Ç–∏–º—á–∞—Å–æ–≤–∏—Ö –ø–æ–º–∏–ª–∫–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞
# (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 500, 502, 503, 504)
from urllib3.util.retry import Retry

# HTTPAdapter - –¥–æ–∑–≤–æ–ª—è—î –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º Retry –¥–æ requests.Session
# –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤, —Ç–∞–π–º–∞—É—Ç—ñ–≤ —ñ –∞–¥–∞–ø—Ç–µ—Ä—ñ–≤ –∑'—î–¥–Ω–∞–Ω–Ω—è
from requests.adapters import HTTPAdapter

# –Ü–º–ø–æ—Ä—Ç—É—î–º–æ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä dataclass –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–ª–∞—Å—ñ–≤ –¥–∞–Ω–∏—Ö
# –î–æ–∑–≤–æ–ª—è—î —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –∫–ª–∞—Å–∏, —è–∫—ñ:
# - –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å –¥–∞–Ω—ñ —É –≤–∏–≥–ª—è–¥—ñ –∞—Ç—Ä–∏–±—É—Ç—ñ–≤
# - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≥–µ–Ω–µ—Ä—É—é—Ç—å –º–µ—Ç–æ–¥–∏ __init__, __repr__, __eq__ —Ç–∞ —ñ–Ω.
# - —Ä–æ–±–ª—è—Ç—å –∫–æ–¥ –±—ñ–ª—å—à —á–∏—Å—Ç–∏–º —Ç–∞ –∑—Ä—É—á–Ω–∏–º –¥–ª—è –æ–±—Ä–æ–±–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö

# –ú–æ–¥—É–ª—å –¥–æ–∑–≤–æ–ª—è—î —á–∏—Ç–∞—Ç–∏ —Ç–∞ –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ –≤ CSV —Ñ–∞–π–ª
import csv

from dataclasses import dataclass, fields, astuple

@dataclass
class Product:
    # –ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É
    title: str
    # –î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å —Ç–æ–≤–∞—Ä—É
    description: str
    # –¶—ñ–Ω–∞ —É –≤–∏–≥–ª—è–¥—ñ —á–∏—Å–ª–∞ –∑ –ø–ª–∞–≤–∞—é—á–æ—é —Ç–æ—á–∫–æ—é
    price: float
    # –†–µ–π—Ç–∏–Ω–≥ —Ç–æ–≤–∞—Ä—É (—Ü—ñ–ª–µ —á–∏—Å–ª–æ –≤—ñ–¥ 1 –¥–æ 5)
    rating: int
    # –ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–¥–≥—É–∫—ñ–≤ –ø—Ä–æ —Ç–æ–≤–∞—Ä
    num_of_reviews: int

# –û—Ç—Ä–∏–º—É—î–º–æ —ñ–º–µ–Ω–∞ –≤—Å—ñ—Ö –ø–æ–ª—ñ–≤ –∫–ª–∞—Å—É Product –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ CSV-–∑–∞–≥–æ–ª–æ–≤–∫—É,
# —â–æ –¥–æ–∑–≤–æ–ª–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏, —è–∫—â–æ –º–∏ –∑–º—ñ–Ω–∏–º–æ –º–æ–¥–µ–ª—å –¥–∞–Ω–∏—Ö
PRODUCT_FIELDS = [field.name for field in fields(Product)]

# –°—Ç–≤–æ—Ä—é—î–º–æ –æ–±'—î–∫—Ç –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö User-Agent
# –ö–æ–∂–µ–Ω –≤–∏–∫–ª–∏–∫ user_agent.random –ø–æ–≤–µ—Ä—Ç–∞—î —ñ–Ω—à–∏–π User-Agent –±—Ä–∞—É–∑–µ—Ä–∞
user_agent = UserAgent()

# –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö HTTP-–∑–∞–ø–∏—Ç—ñ–≤
retry_strategy = Retry(
    total=3,  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–± (1 –æ—Å–Ω–æ–≤–Ω–∞ + 2 –ø–æ–≤—Ç–æ—Ä–∏)
    backoff_factor=1,  # –ë–∞–∑–æ–≤–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –º—ñ–∂ —Å–ø—Ä–æ–±–∞–º–∏ (—Å–µ–∫—É–Ω–¥–∏), –∑—Ä–æ—Å—Ç–∞—î –µ–∫—Å–ø–æ–Ω–µ–Ω—Ü—ñ–π–Ω–æ (1s...2s...4s)
    status_forcelist=[  # –ö–æ–¥–∏ –ø–æ–º–∏–ª–æ–∫, –ø—Ä–∏ —è–∫–∏—Ö —Ç—Ä–µ–±–∞ –ø–æ–≤—Ç–æ—Ä—é–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç
        429,  # Too Many Requests (–∑–∞–Ω–∞–¥—Ç–æ –±–∞–≥–∞—Ç–æ –∑–∞–ø–∏—Ç—ñ–≤, —Å–µ—Ä–≤–µ—Ä —Ç–∏–º—á–∞—Å–æ–≤–æ –±–ª–æ–∫—É—î)
        500,  # Internal Server Error (–≤–Ω—É—Ç—Ä—ñ—à–Ω—è –ø–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞)
        502,  # Bad Gateway (—Å–µ—Ä–≤–µ—Ä –æ—Ç—Ä–∏–º–∞–≤ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ —ñ–Ω—à–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)
        503,  # Service Unavailable (—Å–µ—Ä–≤–µ—Ä —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π)
        504  # Gateway Timeout (—Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç—Ä–∏–º–∞–≤ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ —ñ–Ω—à–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)
    ],
    # Retry –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –¥–æ GET-–∑–∞–ø–∏—Ç—ñ–≤
    allowed_methods=["GET"]
)

# –°—Ç–≤–æ—Ä—é—î–º–æ HTTP-—Å–µ—Å—ñ—é
# Session –¥–æ–∑–≤–æ–ª—è—î:
# - –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ TCP-–∑'—î–¥–Ω–∞–Ω–Ω—è
# - –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏ —à–≤–∏–¥—à–µ, –Ω—ñ–∂ requests.get()
# - –∑–∞–¥–∞–≤–∞—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (headers, retry —Ç–æ—â–æ)
session = requests.Session()

# –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ retry-—Å—Ç—Ä–∞—Ç–µ–≥—ñ—é –¥–ª—è HTTPS-–∑–∞–ø–∏—Ç—ñ–≤
session.mount("https://", HTTPAdapter(max_retries=retry_strategy))

# –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ retry-—Å—Ç—Ä–∞—Ç–µ–≥—ñ—é –¥–ª—è HTTP-–∑–∞–ø–∏—Ç—ñ–≤
session.mount("http://", HTTPAdapter(max_retries=retry_strategy))

# –ë–∞–∑–æ–≤–∏–π –¥–æ–º–µ–Ω —Å–∞–π—Ç—É
BASE_URL = "https://webscraper.io/"

# –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –º–∞–≥–∞–∑–∏–Ω—É
# urljoin –ø–æ—î–¥–Ω—É—î –±–∞–∑–æ–≤–∏–π URL —Ç–∞ –≤—ñ–¥–Ω–æ—Å–Ω–∏–π —à–ª—è—Ö,
# –≥–∞—Ä–∞–Ω—Ç—É—é—á–∏ –∫–æ—Ä–µ–∫—Ç–Ω—É –∞–¥—Ä–µ—Å—É –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Å–ª–µ—à—ñ–≤
HOME_URL = urljoin(BASE_URL, "test-sites/e-commerce/allinone/")

# –§–æ—Ä–º—É—î–º–æ URL —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∑ –Ω–æ—É—Ç–±—É–∫–∞–º–∏, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –±–∞–∑–æ–≤–∏–π URL
LAPTOP_URL = urljoin(BASE_URL, "test-sites/e-commerce/static/computers/laptops/")

# HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–∏ —ñ–º—ñ—Ç—É—é—Ç—å –ø–æ–≤–µ–¥—ñ–Ω–∫—É —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞
HEADERS = {
    # –í–∏–ø–∞–¥–∫–æ–≤–∏–π User-Agent (Chrome, Firefox, Safari —Ç–æ—â–æ)
    'User-Agent': user_agent.random,
    # –¢–∏–ø–∏ –∫–æ–Ω—Ç–µ–Ω—Ç—É, —è–∫—ñ –æ—á—ñ–∫—É—î–º–æ –≤—ñ–¥ —Å–µ—Ä–≤–µ—Ä–∞
    'Accept': (
        'text/html,application/xhtml+xml,application/xml;'
        'q=0.9,image/webp,*/*;q=0.8'
    ),
    # –ú–æ–≤–∞ –∫–æ–Ω—Ç–µ–Ω—Ç—É (—Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ —Ä—ñ–∑–Ω–∏–π HTML)
    'Accept-Language': 'en-US,en;q=0.5',
    # –ó'—î–¥–Ω–∞–Ω–Ω—è –Ω–µ –∑–∞–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –æ–¥—Ä–∞–∑—É, –ø–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è TCP-–∑'—î–¥–Ω–∞–Ω–Ω—è
    'Connection': 'keep-alive',
    # –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç HTTPS, —è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤–µ—Ä—Å—ñ—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    'Upgrade-Insecure-Requests': '1',
}

def get_home_products() -> list[Product]:
    """
    –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î HTML-–∫–æ–¥ –≥–æ–ª–æ–≤–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –º–∞–≥–∞–∑–∏–Ω—É
    —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ –æ–±'—î–∫—Ç—ñ–≤ Product –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ—ó –æ–±—Ä–æ–±–∫–∏

    Returns:
        list[Product] - —Å–ø–∏—Å–æ–∫ –æ–±'—î–∫—Ç—ñ–≤ Product –∞–±–æ None —É —Ä–∞–∑—ñ –ø–æ–º–∏–ª–∫–∏
    """
    try:
        # –í–∏–∫–æ–Ω—É—î–º–æ HTTP GET-–∑–∞–ø–∏—Ç –¥–æ –≥–æ–ª–æ–≤–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        response = session.get(
            HOME_URL,  # URL —Å—Ç–æ—Ä—ñ–Ω–∫–∏
            headers=HEADERS,  # HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–∏
            timeout=10,  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —á–∞—Å –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (—Å–µ–∫—É–Ω–¥–∏)
            verify=True  # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ SSL-—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É
        )

        # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç—É—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
        response.raise_for_status()

        # –ì–µ–Ω–µ—Ä—É—î–º–æ –Ω–æ–≤–∏–π User-Agent –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É
        headers = HEADERS.copy()
        headers["User-Agent"] = user_agent.random

        # –°—Ç–≤–æ—Ä—é—î–º–æ –æ–±'—î–∫—Ç BeautifulSoup –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥—É HTML
        soup = BeautifulSoup(response.content, features="html.parser")

        # –ó–Ω–∞—Ö–æ–¥–∏–º–æ –≤—Å—ñ HTML-–±–ª–æ–∫–∏ —Ç–æ–≤–∞—Ä—ñ–≤
        # ".card-body" - CSS-—Å–µ–ª–µ–∫—Ç–æ—Ä, —è–∫–∏–π –æ–±–≥–æ—Ä—Ç–∞—î –∫–æ–∂–µ–Ω –±–ª–æ–∫ –∑ —Ç–æ–≤–∞—Ä–æ–º –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ
        products = soup.select(".card-body")

        # –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–∂–µ–Ω HTML-–±–ª–æ–∫ –≤ –æ–±'—î–∫—Ç Product
        # - –≤–∏–∫–ª–∏–∫–∞—î–º–æ parse_single_product
        # - –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ —Ç–æ–≤–∞—Ä –≤ –æ–±'—î–∫—Ç Product
        # –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ –æ—Ç—Ä–∏–º—É—î–º–æ —Å–ø–∏—Å–æ–∫ –≥–æ—Ç–æ–≤–∏—Ö Python-–æ–±'—î–∫—Ç—ñ–≤
        return [parse_single_product(product) for product in products]

    # –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫, –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑ HTTP –∞–±–æ –º–µ—Ä–µ–∂–µ—é
    except requests.exceptions.RequestException as e:
        print(f"‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ –∑–∞–ø–∏—Ç—É: {e}")
        return None
    # –û–±—Ä–æ–±–∫–∞ –±—É–¥—å-—è–∫–∏—Ö —ñ–Ω—à–∏—Ö –Ω–µ–æ—á—ñ–∫—É–≤–∞–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫
    except Exception as e:
        print(f"‚ö†Ô∏è –ù–µ–æ—á—ñ–∫—É–≤–∞–Ω–∞ –ø–æ–º–∏–ª–∫–∞: {e}")
        return None

def parse_single_product(product: Tag) -> Product:
    return Product(
        # –ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É
        # .select_one(".title") - —à—É–∫–∞—î –ø–µ—Ä—à–∏–π –µ–ª–µ–º–µ–Ω—Ç –∑ –∫–ª–∞—Å–æ–º "title" –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –±–ª–æ–∫—É —Ç–æ–≤–∞—Ä—É
        # ["title"] - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è HTML-–∞—Ç—Ä–∏–±—É—Ç—É 'title'
        title=product.select_one(".title")["title"],

        # –û–ø–∏—Å —Ç–æ–≤–∞—Ä—É
        # .text - –ø–æ–≤–µ—Ä—Ç–∞—î –≤–µ—Å—å —Ç–µ–∫—Å—Ç –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ HTML-—Ç–µ–≥–∞
        description=product.select_one(".description").text,

        # –¶—ñ–Ω–∞ —Ç–æ–≤–∞—Ä—É
        # .text - –æ—Ç—Ä–∏–º—É—î–º–æ —Ä—è–¥–æ–∫ —Ç–∏–ø—É "$123.45"
        # .replace("$", "") - –ø—Ä–∏–±–∏—Ä–∞—î–º–æ —Å–∏–º–≤–æ–ª –≤–∞–ª—é—Ç–∏, —â–æ–± –∑–∞–ª–∏—à–∏–ª–∏—Å—è –ª–∏—à–µ —Ü–∏—Ñ—Ä–∏
        # float(...) - –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ —Ç–µ–∫—Å—Ç –≤ —á–∏—Å–ª–æ –∑ –ø–ª–∞–≤–∞—é—á–æ—é –∫—Ä–∞–ø–∫–æ—é
        price=float(
            product
            .select_one(".price")
            .text
            .replace("$", "")
        ),

        # –†–µ–π—Ç–∏–Ω–≥ —Ç–æ–≤–∞—Ä—É
        # [data-rating] - HTML-–∞—Ç—Ä–∏–±—É—Ç –∑ —á–∏—Å–ª–æ–≤–∏–º –∑–Ω–∞—á–µ–Ω–Ω—è–º —Ä–µ–π—Ç–∏–Ω–≥—É
        # int(...) - –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ —Ç–µ–∫—Å—Ç–æ–≤–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –≤ —Ü—ñ–ª–µ —á–∏—Å–ª–æ
        rating=int(
            product
            .select_one("[data-rating]")["data-rating"]
        ),

        # –ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–¥–≥—É–∫—ñ–≤
        # .text - —Ä—è–¥–æ–∫ —Ç–∏–ø—É "12 reviews"
        # .split()[0] - —Ä–æ–∑–±–∏–≤–∞—î–º–æ —Ä—è–¥–æ–∫ –∑–∞ –ø—Ä–æ–±—ñ–ª–æ–º —Ç–∞ –æ—Ç—Ä–∏–º—É—î–º–æ –ø–µ—Ä—à–µ —Å–ª–æ–≤–æ ("12")
        # int(...) - –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –ø–µ—Ä—à–µ —Å–ª–æ–≤–æ –≤ —á–∏—Å–ª–æ
        num_of_reviews=int(
            product
            .select_one(".review-count")
            .text
            .split()[0]
        )
    )

def get_laptop_page_products() -> list[Product]:
    """
    –û—Ç—Ä–∏–º—É—î –≤—Å—ñ —Ç–æ–≤–∞—Ä–∏ –∑ —É—Å—ñ—Ö —Å—Ç–æ—Ä—ñ–Ω–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –Ω–æ—É—Ç–±—É–∫—ñ–≤.

    –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î:
    - HTTP-—Å–µ—Å—ñ—é –¥–ª—è —Å—Ç–∞–±—ñ–ª—å–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤
    - –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è —ñ–º—ñ—Ç–∞—Ü—ñ—ó –±—Ä–∞—É–∑–µ—Ä–∞
    - –§—É–Ω–∫—Ü—ñ—é get_single_page_products() –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥—É –∫–æ–∂–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    - –§—É–Ω–∫—Ü—ñ—é get_num_pages() –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞–≥–∞–ª—å–Ω–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–æ–∫

    Returns:
        list[Product]: –ü–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤ –∑ —É—Å—ñ—Ö —Å—Ç–æ—Ä—ñ–Ω–æ–∫
    """

    # –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –ø–µ—Ä—à—É —Å—Ç–æ—Ä—ñ–Ω–∫—É —á–µ—Ä–µ–∑ HTTP-—Å–µ—Å—ñ—é
    try:
        response = session.get(LAPTOP_URL, headers=HEADERS, timeout=10, verify=True)

        # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –∑–∞–ø–∏—Ç –ø—Ä–æ–π—à–æ–≤ —É—Å–ø—ñ—à–Ω–æ (–∫–æ–¥ 200 OK)
        response.raise_for_status()

        # –°—Ç–≤–æ—Ä—é—î–º–æ –æ–±'—î–∫—Ç BeautifulSoup –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥—É HTML
        first_page_soup = BeautifulSoup(response.content, features="html.parser")

        # –û—Ç—Ä–∏–º—É—î–º–æ —Ç–æ–≤–∞—Ä–∏ –∑ –ø–µ—Ä—à–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        # –°—Ç–≤–æ—Ä—é—î–º–æ –∑–∞–≥–∞–ª—å–Ω–∏–π —Å–ø–∏—Å–∫–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤ (all_products)
        all_products = get_single_page_products(first_page_soup)

        # –í–∏–∑–Ω–∞—á–∞—î–º–æ –∑–∞–≥–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç–æ—Ä—ñ–Ω–æ–∫ –≤ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
        num_pages = get_num_pages(first_page_soup)
        print(f"–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç–æ—Ä—ñ–Ω–æ–∫ –∑ —Ç–æ–≤–∞—Ä–∞–º–∏: {num_pages} ")
        print(f"–û–±—Ä–æ–±–ª—è—î–º–æ —Å—Ç–æ—Ä—ñ–Ω–∫—É 1 –∑ {num_pages}")

        # –û–±—Ä–æ–±–ª—è—î–º–æ —Ä–µ—à—Ç—É —Å—Ç–æ—Ä—ñ–Ω–æ–∫ (–ø–æ—á–∏–Ω–∞—é—á–∏ –∑ 2 —Å—Ç–æ—Ä—ñ–Ω–∫–∏)
        for page_num in range(2, num_pages + 1):
            print(f"–û–±—Ä–æ–±–ª—è—î–º–æ —Å—Ç–æ—Ä—ñ–Ω–∫—É {page_num} –∑ {num_pages}")

            # –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä –ø–∞–≥—ñ–Ω–∞—Ü—ñ—ó
            response = session.get(
                LAPTOP_URL,
                headers=HEADERS,
                params={"page": page_num},  # –ø–∞—Ä–∞–º–µ—Ç—Ä –ø–∞–≥—ñ–Ω–∞—Ü—ñ—ó
                timeout=10,
                verify=True
            )
            response.raise_for_status()

            # –ü–∞—Ä—Å–∏–º–æ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É
            next_page_soup = BeautifulSoup(response.content, features="html.parser")
            # –î–æ–¥–∞—î–º–æ —Ç–æ–≤–∞—Ä–∏ –¥–æ –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É all_products
            all_products.extend(get_single_page_products(next_page_soup))

        print(f"–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—ñ–≤: {len(all_products)}")
        # –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –ø–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤
        return all_products

    except requests.exceptions.RequestException as e:
        print(f"‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–æ–∫: {e}")
        return []
    except Exception as e:
        print(f"‚ö†Ô∏è –ù–µ–æ—á—ñ–∫—É–≤–∞–Ω–∞ –ø–æ–º–∏–ª–∫–∞: {e}")
        return []


def get_num_pages(page_soup: Tag) -> int:
    """
    –í–∏–∑–Ω–∞—á–∞—î –∑–∞–≥–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç–æ—Ä—ñ–Ω–æ–∫ –ø—Ä–∏ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—ó

    Args:
        page_soup: –û–±'—î–∫—Ç BeautifulSoup –∑ HTML-—Å—Ç–æ—Ä—ñ–Ω–∫–æ—é
    Returns:
        int: –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç–æ—Ä—ñ–Ω–æ–∫ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 1, —è–∫—â–æ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—è –≤—ñ–¥—Å—É—Ç–Ω—è)
    """

    # –í–∏–∫–æ–Ω—É—î–º–æ –ø–æ—à—É–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—ó –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –∑–∞ CSS-–∫–ª–∞—Å–æ–º ".pagination"
    pagination = page_soup.select_one(".pagination")

    # –Ø–∫—â–æ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞, –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ 1 (–æ–¥–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞)
    if pagination is None:
        return 1

    # –Ø–∫—â–æ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—è —î:
    # - –ë–µ—Ä–µ–º–æ –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—ó (<li>)
    # - –ü–µ—Ä–µ–¥–æ—Å—Ç–∞–Ω–Ω—ñ–π –µ–ª–µ–º–µ–Ω—Ç –∑–∞–∑–≤–∏—á–∞–π –º—ñ—Å—Ç–∏—Ç—å –Ω–æ–º–µ—Ä –æ—Å—Ç–∞–Ω–Ω—å–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (–ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ—é "Next")
    # - –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è [-2] –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ –º–∏ –±–µ—Ä–µ–º–æ –æ—Å—Ç–∞–Ω–Ω—ñ–π –Ω–æ–º–µ—Ä —Å—Ç–æ—Ä—ñ–Ω–∫–∏, –∞ –Ω–µ –∫–Ω–æ–ø–∫—É Next.
    # - –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ —Ç–µ–∫—Å—Ç –≤ —Ü—ñ–ª–µ —á–∏—Å–ª–æ
    return int(pagination.select("li")[-2].text)


def get_single_page_products(page_soup: Tag) -> list[Product]:
    """
    –ü–∞—Ä—Å–∏—Ç—å HTML-—Å—Ç–æ—Ä—ñ–Ω–∫—É —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤.

    Args:
        page_soup: –û–±'—î–∫—Ç BeautifulSoup –∑ HTML-—Å—Ç–æ—Ä—ñ–Ω–∫–æ—é
    Returns:
        list[Product]: –°–ø–∏—Å–æ–∫ –æ–±'—î–∫—Ç—ñ–≤ Product –∑ –¥–∞–Ω–∏–º–∏ –ø—Ä–æ —Ç–æ–≤–∞—Ä–∏
    """

    # –í–∏–∫–æ–Ω—É—î–º–æ –ø–æ—à—É–∫ –≤—Å—ñ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤ —Ç–æ–≤–∞—Ä—ñ–≤ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –∑–∞ CSS-–∫–ª–∞—Å–æ–º ".card-body"
    products = page_soup.select(".card-body")

    # –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–∂–µ–Ω HTML-–µ–ª–µ–º–µ–Ω—Ç –≤ –æ–±'—î–∫—Ç Product
    return [parse_single_product(product) for product in products]

def write_products_to_csv(products: list[Product]) -> None:
    """
    –ó–±–µ—Ä—ñ–≥–∞—î —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤ –≤ CSV-—Ñ–∞–π–ª

    Args:
        products: –°–ø–∏—Å–æ–∫ –æ–±'—î–∫—Ç—ñ–≤ Product –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
    """
    # –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø–∏—Å—É
    with open("products.csv", "w", newline='', encoding='utf-8') as f:
        # –°—Ç–≤–æ—Ä—é—î–º–æ –æ–±'—î–∫—Ç writer –¥–ª—è –∑–∞–ø–∏—Å—É –¥–∞–Ω–∏—Ö –≤ CSV
        writer = csv.writer(f)

        # –ó–∞–ø–∏—Å—É—î–º–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å—Ç–æ–≤–ø—Ü—ñ–≤
        writer.writerow(PRODUCT_FIELDS)

        # –ó–∞–ø–∏—Å—É—î–º–æ –¥–∞–Ω—ñ –∫–æ–∂–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä—É
        # (astuple –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î –æ–±'—î–∫—Ç Product –≤ –∫–æ—Ä—Ç–µ–∂ –∑–Ω–∞—á–µ–Ω—å)
        writer.writerows([astuple(product) for product in products])

def main():
    """
    –ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –ø—Ä–æ–≥—Ä–∞–º–∏:
    - –û—Ç—Ä–∏–º—É—î —Å–ø–∏—Å–æ–∫ –Ω–æ—É—Ç–±—É–∫—ñ–≤ –∑—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    - –ó–±–µ—Ä—ñ–≥–∞—î —ó—Ö —É CSV-—Ñ–∞–π–ª
    - –û–±—Ä–æ–±–ª—è—î –ø–æ–º–∏–ª–∫–∏ —Ç–∞ –∑–∞–∫—Ä–∏–≤–∞—î —Ä–µ—Å—É—Ä—Å–∏
    """
    try:
        # –û—Ç—Ä–∏–º—É—î–º–æ —Ç–æ–≤–∞—Ä–∏ —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ —ó—Ö –≤ CSV
        write_products_to_csv(get_laptop_page_products())
        print("‚úÖ –î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ —Ñ–∞–π–ª 'products.csv'")

    except KeyboardInterrupt:
        print("\nüõë –†–æ–±–æ—Ç—É –ø—Ä–æ–≥—Ä–∞–º–∏ –ø–µ—Ä–µ—Ä–≤–∞–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º.")
    except Exception as e:
        print(f"‚ùå –ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞: {e}")
    finally:
        session.close()

if __name__ == "__main__":
    main()